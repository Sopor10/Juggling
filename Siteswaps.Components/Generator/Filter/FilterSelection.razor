@using Siteswaps.Components.Generator.State
@inherits FluxorComponent
@inject IDispatcher _dispatcher
@inject IState<SiteswapGeneratorState> _state
<div class="container">
    <div class="row">
        <div class="col-sm">
            <label for="filterSelect">Select Filter</label>
            <select id="filterSelect" class="custom-select" value="@Value?.FilterType" @onchange="SelectionChanged">
                <option disabled selected value> -- select an option -- </option>
                @foreach (var filter in KnownFilters.AvailableSelection())
                {
                    <option value="@filter">@filter</option>
                }
            </select>
        </div>
    </div>

    @if (Value is not null)
    {
        <div class="row">

            <DynamicComponent Type="@KnownFilters.MapFilterInformationToRenderType(Value)" Parameters="@Parameter(Value)"></DynamicComponent>
            <div class="col-md-3">
                <button type="button" class="btn-primary " @onclick="OnClick">Add</button>
            </div>
        </div>
    }
</div>


@code {

    public IFilterInformation? Value => _state.Value.NewFilter;

    private void SelectionChanged(ChangeEventArgs eventArgs)
    {
        if (Enum.TryParse(eventArgs.Value?.ToString(), out FilterType filterType))
        {
           _dispatcher.Dispatch(new FilterTypeSelectionChangedAction(filterType));
        }
    }

    private void OnClick()
    {
        if (Value is not null)
        {
            _dispatcher.Dispatch(new NewFilterCreatedAction(Value));
        }
    }
    private IDictionary<string, object> Parameter(IFilterInformation information) => new Dictionary<string, object>()
    {
        {"Value", information}
    };

    private KnownFilterTypes KnownFilters => _state.Value.KnownFilters;

}