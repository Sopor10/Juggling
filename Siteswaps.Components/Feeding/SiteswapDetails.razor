@page "/SiteswapDetails"
@using System.Collections.Immutable
@using Siteswaps.Generator.Generator

<table>
    @foreach (var siteswap in Siteswaps.Select(siteswap => siteswap))
    {
        <tr >
            <td > @siteswap.DisplayName</td>
            @for (var j = 0; j < siteswap.Juggler; j++)
            {
                <td />
            }

            @for (var i = 0; i < siteswap.Values.Length; i++)
            {
                <td>
                    @siteswap.Values[i].Transform()
                    @if (siteswap.GetThrowType(i).Juggler != siteswap.Juggler)
                    {
                        @if (siteswap.GetThrowType(i).Hand != CurrentHand(i))
                        {
                            <sub>
                                @if (Siteswaps.Count > 2)
                                {
                                    @GetPassingPartner(siteswap.Juggler, i)
                                }
                                ||
                            </sub>
                        }
                        @if (siteswap.GetThrowType(i).Hand == CurrentHand(i))
                        {
                            <sub>
                                @if (Siteswaps.Count > 2)
                                {
                                    @GetPassingPartner(siteswap.Juggler, i)
                                }
                                x
                            </sub>
                        }
                    }
                </td>
                @for (var j = 0; j < NumberOfTimeZones; j++)
                {
                    <td/>
                }
            }
        </tr>
    }
</table>

@code {

    [Parameter]
    public ImmutableList<LocalSiteswap> Siteswaps { get; set; } = Siteswap.CreateFromCorrect(7, 5, 6, 6).GetLocalSiteswaps(3).ToImmutableList();

    [Parameter]
    public ImmutableList<ImmutableList<string>>? PassingPartners { get; set; }

    private int NumberOfTimeZones => Siteswaps.Select(siteswap => siteswap.Juggler).Distinct().Count();

    private Hand CurrentHand(int i)
    {
        return i % 2 == 0 ? Hand.Right : Hand.Left;
    }

    private string GetPassingPartner(int siteswapNumber, int i)
    {
        if (PassingPartners == null)
        {
            return Siteswaps[Siteswaps[siteswapNumber].GetThrowType(i).Juggler].DisplayName;
        }

        return PassingPartners[siteswapNumber][i];
    }

}
